"use strict";
var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var app = getApp();
var HeroBasic = (function () {
    function HeroBasic(name, type, level, img) {
        this.name = name;
        this.type = type;
        this.level = level;
        this.img = img;
    }
    return HeroBasic;
}());
var Hero = (function (_super) {
    __extends(Hero, _super);
    function Hero(name, camp, type, level, sex, characteristic, tags, hidden, name_en, img) {
        var _this = _super.call(this, name, type, level, img) || this;
        _this.camp = camp;
        _this.sex = sex;
        _this.characteristic = characteristic;
        _this.tags = tags;
        _this.hidden = hidden;
        _this["name-en"] = name_en;
        return _this;
    }
    return Hero;
}(HeroBasic));
Page({
    data: {
        tags: [
            {
                "cn": "资质",
                "cntags": ["新手", "资深干员", "高级资深干员"],
                "en": "Qualification",
                "entags": ["Newbie", "Senior", "Advanced Senior"]
            },
            {
                "cn": "位置",
                "cntags": ["远程位", "近战位"],
                "en": "Position",
                "entags": ["Ranged", "Melee"]
            },
            {
                "cn": "性别",
                "cntags": ["男性干员", "女性干员"],
                "en": "Gender",
                "entags": ["Male", "Female"]
            },
            {
                "cn": "种类",
                "cntags": ["先锋干员", "狙击干员", "医疗干员", "术师干员", "近卫干员", "重装干员", "辅助干员", "特种干员"],
                "en": "Class",
                "entags": ["Vanguard", "Sniper", "Medic", "Caster", "Guard", "Defender", "Support",
                    "Specialist"
                ]
            },
            {
                "cn": "词缀",
                "cntags": ["治疗", "支援", "输出", "群攻", "减速", "生存", "防护", "削弱", "位移", "控场", "爆发", "召唤",
                    "快速复活", "费用回复"
                ],
                "en": "Affix",
                "entags": ["Healing", "Support", "DPS", "Splash", "Slow", "Survival", "Protection",
                    "Debuffer", "Displacement", "Crowd Control", "Burst", "Summoner",
                    "Quick Resurrection", "Cost Recovery"
                ]
            }
        ],
        tags_aval: {},
        all_chars: {},
        avg_char_tag: 0,
        checkedTags: [],
        checkedTagsTL: [],
        possible: []
    },
    onLoad: function () {
        this.init();
    },
    bindViewTap: function () {
        wx.navigateTo({
            url: '../index/index'
        });
    },
    calc: function () {
        var len = this.data.checkedTags.length;
        var count = Math.pow(2, this.data.checkedTags.length);
        var combs = [];
        for (var i = 0; i < count; i++) {
            var ts = [];
            var tsTL = [];
            for (var j = 0, mask = 1; j < len; j++) {
                if ((i & mask) !== 0) {
                    ts.push(this.data.checkedTags[j]);
                    tsTL.push(this.data.checkedTagsTL[j]);
                }
                mask = mask * 2;
            }
            combs.push({
                "tags": ts,
                "tagsTL": tsTL,
                "score": 0.0,
                "possible": []
            });
        }
        var optStars = ["all", "6", "5", "4", "3", "2", "1"];
        var that = this;
        combs.forEach(function (comb) {
            var tags = comb.tags;
            if (tags.length === 0 || tags.length > 3)
                return;
            var chars = that.data.tags_aval[tags[0]].slice();
            var _loop_1 = function (i) {
                var reduced_chars = [];
                chars.forEach(function (char) {
                    var tmp = that.data.tags_aval[tags[i]];
                    tmp.forEach(function (tgch) {
                        if (char.name === tgch.name) {
                            reduced_chars.push(char);
                            return false;
                        }
                    });
                });
                chars = reduced_chars;
            };
            for (var i = 1; i < tags.length; i++) {
                _loop_1(i);
            }
            if (chars.length === 0)
                return;
            if (!tags.includes("高级资深干员")) {
                var reduce6_1 = [];
                chars.forEach(function (char) {
                    if (char.level !== 6) {
                        reduce6_1.push(char);
                    }
                });
                chars = reduce6_1;
            }
            var filtered_chars = [];
            chars.forEach(function (char) {
                if (optStars.includes(char.level.toString())) {
                    filtered_chars.push(char);
                }
            });
            chars = filtered_chars;
            comb.possible = chars;
            if (chars.length === 0)
                return;
            var s = 0;
            chars.forEach(function (char) {
                s += char.level;
            });
            s = s / chars.length;
            comb.score = s + 0.1 / tags.length + 0.9 / chars.length;
        });
        combs.sort(function (a, b) {
            return a.score > b.score ? -1 : (a.score < b.score ? 1 :
                (a.tags.length > b.tags.length ? 1 : (a.tags.length < b.tags.length ? -1 :
                    0)));
        });
        combs.forEach(function (comb) {
            if (!comb.possible || comb.possible.length === 0)
                return false;
            var chars = comb.possible;
          console.log(chars);
            that.setData({ possible: chars });
            var tags = comb.tags;
            var tagsTL = comb.tagsTL;
            var chars_html;
            comb.possible.sort(function (a, b) {
                return a.level > b.level ? -1 : (a.level < b.level ? 1 : 0);
            });
        });
      console.log(combs);
    },
    init: function () {
        var _that = this;
        app.func.get('/akhr.json', {}, function (data) {
            var tag_count = 0;
            var char_tag_sum = 0;
            var _loop_2 = function (key) {
                if (data.hasOwnProperty(key)) {
                    var char_1 = data[key];
                    if (char_1.hidden)
                        return "continue";
                    char_1.tags.push(char_1.type + "干员");
                    char_1.tags.push(char_1.sex + "性干员");
                    var name_1 = char_1.name;
                    char_1.tags.forEach(function (tag) {
                        if (tag in _that.data.tags_aval) {
                            var tmp_1 = _that.data.tags_aval;
                            tmp_1[tag].push({
                                "name": name_1,
                                "img": char_1["name-en"],
                                "level": char_1.level,
                                "type": char_1.type
                            });
                            _that.setData({ tags_aval: tmp_1 });
                        }
                        else {
                            var tmp_2 = _that.data.tags_aval;
                            tmp_2[tag] = [{
                                    "name": name_1,
                                    "img": char_1["name-en"],
                                    "level": char_1.level,
                                    "type": char_1.type
                                }];
                            _that.setData({ tags_aval: tmp_2 });
                            tag_count++;
                        }
                        char_tag_sum++;
                    });
                    var tmp = _that.data.all_chars;
                    tmp.name = {
                        'level': char_1.level,
                        'tags': char_1.tags
                    };
                    _that.setData({ all_chars: tmp });
                }
            };
            for (var key in data) {
                _loop_2(key);
            }
            _that.setData({ avg_char_tag: (char_tag_sum / tag_count) });
            _that.setData({ checkedTags: ["治疗"] });
            _that.calc();
        });
    },
    clickTag: function (event) {
        console.log(event);
        var _that = this;
        var tag = event.target.dataset.title;
        var checked = false;
        if (tag in _that.data.checkedTags) {
            checked = true;
        }
        if (checked) {
            _that.data.checkedTags = _that.data.checkedTags.filter(function (v, _, __) {
                return v !== tag;
            });
        }
        else {
            if (_that.data.checkedTags.length >= 6) {
                wx.showToast({
                    title: "无法选择更多标签：最多6个。",
                    icon: "none",
                    duration: 2000
                });
                return;
            }
            else {
                _that.data.checkedTags.push(tag);
                _that.setData({
                    checkedTags: _that.data.checkedTags
                });
            }
        }
        _that.calc();
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGFncy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInRhZ3MudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFDQSxJQUFJLEdBQUcsR0FBRyxNQUFNLEVBQUUsQ0FBQTtBQUVsQjtJQU1FLG1CQUFZLElBQVksRUFBRSxJQUFZLEVBQUUsS0FBYSxFQUFFLEdBQVc7UUFDaEUsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7SUFDakIsQ0FBQztJQUVILGdCQUFDO0FBQUQsQ0FBQyxBQWJELElBYUM7QUFFRDtJQUFtQix3QkFBUztJQVMxQixjQUFZLElBQVksRUFBRSxJQUFZLEVBQUUsSUFBWSxFQUFFLEtBQWEsRUFBRSxHQUFXLEVBQUUsY0FBc0IsRUFBRSxJQUFRLEVBQUUsTUFBZSxFQUFFLE9BQWUsRUFBRSxHQUFXO1FBQWpLLFlBQ0Usa0JBQU0sSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLFNBUTlCO1FBUEMsS0FBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsS0FBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUM7UUFDZixLQUFJLENBQUMsY0FBYyxHQUFHLGNBQWMsQ0FBQztRQUNyQyxLQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixLQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUNyQixLQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsT0FBTyxDQUFDOztJQUU1QixDQUFDO0lBQ0gsV0FBQztBQUFELENBQUMsQUFuQkQsQ0FBbUIsU0FBUyxHQW1CM0I7QUFJRCxJQUFJLENBQUM7SUFDSCxJQUFJLEVBQUU7UUFDSixJQUFJLEVBQUU7WUFDSjtnQkFDRSxJQUFJ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Q0FBQztnQkFBRSxPQUFPO1lBQy9CLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNWLEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxJQUFTO2dCQUMvQixDQUFDLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQztZQUNsQixDQUFDLENBQUMsQ0FBQztZQUNILENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztZQUNyQixJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sR0FBRyxHQUFHLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztRQUMxRCxDQUFDLENBQUMsQ0FBQztRQUNILEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztZQUN2QixPQUFPLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDdEQsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUN4RSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQztRQUVILEtBQUssQ0FBQyxPQUFPLENBQUMsVUFBVSxJQUFTO1lBQy9CLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUM7Z0JBQUUsT0FBTyxLQUFLLENBQUM7WUFDL0QsSUFBSSxLQUFLLEdBQUcs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QUMsTUFBTSxJQUFJLENBQUMsRUFBRTtnQkFFdEMsRUFBRSxDQUFDLFNBQVMsQ0FBQztvQkFDWCxLQUFLLEVBQUUsZ0JBQWdCO29CQUN2QixJQUFJLEVBQUUsTUFBTTtvQkFDWixRQUFRLEVBQUUsSUFBSTtpQkFDZixDQUFDLENBQUE7Z0JBR0YsT0FBTzthQUNSO2lCQUFNO2dCQUVMLEtBQUssQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDakMsS0FBSyxDQUFDLE9BQU8sQ0FBQztvQkFDWixXQUFXLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxXQUFXO2lCQUNwQyxDQUFDLENBQUM7YUFFSjtTQUNGO1FBRUQsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDO0lBSWYsQ0FBQztDQUdGLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vdGFncy5qc1xyXG52YXIgYXBwID0gZ2V0QXBwKClcclxuXHJcbmNsYXNzIEhlcm9CYXNpYyB7XHJcbiAgbmFtZT86IHN0cmluZztcclxuICB0eXBlPzogc3RyaW5nO1xyXG4gIGxldmVsPzogbnVtYmVyO1xyXG4gIGltZz86IHN0cmluZ1xyXG5cclxuICBjb25zdHJ1Y3RvcihuYW1lOiBzdHJpbmcsIHR5cGU6IHN0cmluZywgbGV2ZWw6IG51bWJlciwgaW1nOiBzdHJpbmcpIHtcclxuICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICB0aGlzLnR5cGUgPSB0eXBlO1xyXG4gICAgdGhpcy5sZXZlbCA9IGxldmVsO1xyXG4gICAgdGhpcy5pbWcgPSBpbWc7XHJcbiAgfVxyXG5cclxufVxyXG5cclxuY2xhc3MgSGVybyBleHRlbmRzIEhlcm9CYXNpYyB7XHJcbiAgY2FtcD86IHN0cmluZztcclxuICBzZXg/OiBzdHJpbmc7XHJcbiAgY2hhcmFjdGVyaXN0aWM/OiBzdHJpbmc7XHJcbiAgdGFncz86IHN0cmluZ1tdO1xyXG4gIGhpZGRlbj86IGJvb2xlYW47XHJcbiAgXCJuYW1lLWVuXCI/OiBzdHJpbmc7XHJcblxyXG5cclxuICBjb25zdHJ1Y3RvcihuYW1lOiBzdHJpbmcsIGNhbXA6IHN0cmluZywgdHlwZTogc3RyaW5nLCBsZXZlbDogbnVtYmVyLCBzZXg6IHN0cmluZywgY2hhcmFjdGVyaXN0aWM6IHN0cmluZywgdGFnczogW10sIGhpZGRlbjogYm9vbGVhbiwgbmFtZV9lbjogc3RyaW5nLCBpbWc6IHN0cmluZykge1xyXG4gICAgc3VwZXIobmFtZSwgdHlwZSwgbGV2ZWwsIGltZyk7XHJcbiAgICB0aGlzLmNhbXAgPSBjYW1wO1xyXG4gICAgdGhpcy5zZXggPSBzZXg7XHJcbiAgICB0aGlzLmNoYXJhY3RlcmlzdGljID0gY2hhcmFjdGVyaXN0aWM7XHJcbiAgICB0aGlzLnRhZ3MgPSB0YWdzO1xyXG4gICAgdGhpcy5oaWRkZW4gPSBoaWRkZW47XHJcbiAgICB0aGlzW1wibmFtZS1lblwiXSA9IG5hbWVfZW47XHJcblxyXG4gIH1cclxufVxyXG5cclxuXHJcblxyXG5QYWdlKHtcclxuICBkYXRhOiB7XHJcbiAgICB0YWdzOiBbXHJcbiAgICAgIHtcclxuICAgICAgICBcImNuXCI6IFwi6LWE6LSoXCIsXHJcbiAgICAgICAgXCJjbnRhZ3NcIjogW1wi5paw5omLXCIsIFwi6LWE5rex5bmy5ZGYXCIsIFwi6auY57qn6LWE5rex5bmy5ZGYXCJdLFxyXG4gICAgICAgIFwiZW5cIjogXCJRdWFsaWZpY2F0aW9uXCIsXHJcbiAgICAgICAgXCJlbnRhZ3NcIjogW1wiTmV3YmllXCIsIFwiU2VuaW9yXCIsIFwiQWR2YW5jZWQgU2VuaW9yXCJdXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBcImNuXCI6IFwi5L2N572uXCIsXHJcbiAgICAgICAgXCJjbnRhZ3NcIjogW1wi6L+c56iL5L2NXCIsIFwi6L+R5oiY5L2NXCJdLFxyXG4gICAgICAgIFwiZW5cIjogXCJQb3NpdGlvblwiLFxyXG4gICAgICAgIFwiZW50YWdzXCI6IFtcIlJhbmdlZFwiLCBcIk1lbGVlXCJdXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBcImNuXCI6IFwi5oCn5YirXCIsXHJcbiAgICAgICAgXCJjbnRhZ3NcIjogW1wi55S35oCn5bmy5ZGYXCIsIFwi5aWz5oCn5bmy5ZGYXCJdLFxyXG4gICAgICAgIFwiZW5cIjogXCJHZW5kZXJcIixcclxuICAgICAgICBcImVudGFnc1wiOiBbXCJNYWxlXCIsIFwiRmVtYWxlXCJdXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBcImNuXCI6IFwi56eN57G7XCIsXHJcbiAgICAgICAgXCJjbnRhZ3NcIjogW1wi5YWI6ZSL5bmy5ZGYXCIsIFwi54uZ5Ye75bmy5ZGYXCIsIFwi5Yy755aX5bmy5ZGYXCIsIFwi5pyv5biI5bmy5ZGYXCIsIFwi6L+R5Y2r5bmy5ZGYXCIsIFwi6YeN6KOF5bmy5ZGYXCIsIFwi6L6F5Yqp5bmy5ZGYXCIsIFwi54m556eN5bmy5ZGYXCJdLFxyXG4gICAgICAgIFwiZW5cIjogXCJDbGFzc1wiLFxyXG4gICAgICAgIFwiZW50YWdzXCI6IFtcIlZhbmd1YXJkXCIsIFwiU25pcGVyXCIsIFwiTWVkaWNcIiwgXCJDYXN0ZXJcIiwgXCJHdWFyZFwiLCBcIkRlZmVuZGVyXCIsIFwiU3VwcG9ydFwiLFxyXG4gICAgICAgICAgXCJTcGVjaWFsaXN0XCJcclxuICAgICAgICBdXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBcImNuXCI6IFwi6K+N57yAXCIsXHJcbiAgICAgICAgXCJjbnRhZ3NcIjogW1wi5rK755aXXCIsIFwi5pSv5o+0XCIsIFwi6L6T5Ye6XCIsIFwi576k5pS7XCIsIFwi5YeP6YCfXCIsIFwi55Sf5a2YXCIsIFwi6Ziy5oqkXCIsIFwi5YmK5byxXCIsIFwi5L2N56e7XCIsIFwi5o6n5Zy6XCIsIFwi54iG5Y+RXCIsIFwi5Y+s5ZSkXCIsXHJcbiAgICAgICAgICBcIuW/q+mAn+Wkjea0u1wiLCBcIui0ueeUqOWbnuWkjVwiXHJcbiAgICAgICAgXSxcclxuICAgICAgICBcImVuXCI6IFwiQWZmaXhcIixcclxuICAgICAgICBcImVudGFnc1wiOiBbXCJIZWFsaW5nXCIsIFwiU3VwcG9ydFwiLCBcIkRQU1wiLCBcIlNwbGFzaFwiLCBcIlNsb3dcIiwgXCJTdXJ2aXZhbFwiLCBcIlByb3RlY3Rpb25cIixcclxuICAgICAgICAgIFwiRGVidWZmZXJcIiwgXCJEaXNwbGFjZW1lbnRcIiwgXCJDcm93ZCBDb250cm9sXCIsIFwiQnVyc3RcIiwgXCJTdW1tb25lclwiLFxyXG4gICAgICAgICAgXCJRdWljayBSZXN1cnJlY3Rpb25cIiwgXCJDb3N0IFJlY292ZXJ5XCJcclxuICAgICAgICBdXHJcbiAgICAgIH1cclxuICAgIF0sXHJcbiAgICB0YWdzX2F2YWw6IHt9ID0ge30sXHJcbiAgICBhbGxfY2hhcnM6IHt9ID0ge30sXHJcbiAgICBhdmdfY2hhcl90YWc6IDAsXHJcbiAgICBjaGVja2VkVGFnczogW10gPSBbXSxcclxuICAgIGNoZWNrZWRUYWdzVEw6IFtdID0gW10sXHJcbiAgICBwb3NzaWJsZTpbXT1bXVxyXG5cclxuICB9LFxyXG5cclxuICBvbkxvYWQoKSB7XHJcbiAgICAvLyB0aGlzLnNldERhdGEhKHtcclxuICAgIC8vICAgbG9nczogKHd4LmdldFN0b3JhZ2VTeW5jKCdsb2dzJykgfHwgW10pLm1hcCgobG9nOiBudW1iZXIpID0+IHtcclxuICAgIC8vICAgICByZXR1cm4gZm9ybWF0VGltZShuZXcgRGF0ZShsb2cpKVxyXG4gICAgLy8gICB9KVxyXG4gICAgLy8gfSlcclxuICAgIHRoaXMuaW5pdCgpO1xyXG5cclxuICB9LFxyXG5cclxuICBiaW5kVmlld1RhcCgpIHtcclxuICAgIHd4Lm5hdmlnYXRlVG8oe1xyXG4gICAgICB1cmw6ICcuLi9pbmRleC9pbmRleCdcclxuICAgIH0pXHJcbiAgfSxcclxuXHJcbiAgY2FsYygpIHtcclxuXHJcbiAgICBsZXQgbGVuID0gdGhpcy5kYXRhLmNoZWNrZWRUYWdzLmxlbmd0aDtcclxuICAgIGxldCBjb3VudCA9IE1hdGgucG93KDIsIHRoaXMuZGF0YS5jaGVja2VkVGFncy5sZW5ndGgpO1xyXG4gICAgbGV0IGNvbWJzID0gW107XHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcclxuICAgICAgbGV0IHRzOiBbXSA9IFtdO1xyXG4gICAgICBsZXQgdHNUTDogW10gPSBbXTtcclxuICAgICAgZm9yIChsZXQgaiA9IDAsIG1hc2sgPSAxOyBqIDwgbGVuOyBqKyspIHtcclxuICAgICAgICBpZiAoKGkgJiBtYXNrKSAhPT0gMCkge1xyXG4gICAgICAgICAgdHMucHVzaCh0aGlzLmRhdGEuY2hlY2tlZFRhZ3Nbal0pO1xyXG4gICAgICAgICAgdHNUTC5wdXNoKHRoaXMuZGF0YS5jaGVja2VkVGFnc1RMW2pdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbWFzayA9IG1hc2sgKiAyO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbWJzLnB1c2goe1xyXG4gICAgICAgIFwidGFnc1wiOiB0cyxcclxuICAgICAgICBcInRhZ3NUTFwiOiB0c1RMLFxyXG4gICAgICAgIFwic2NvcmVcIjogMC4wLFxyXG4gICAgICAgIFwicG9zc2libGVcIjogW11cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvLyBjb25zb2xlLmxvZyhjb21icyk7XHJcbiAgICBsZXQgb3B0U3RhcnM6IHN0cmluZ1tdID0gW1wiYWxsXCIsIFwiNlwiLCBcIjVcIiwgXCI0XCIsIFwiM1wiLCBcIjJcIiwgXCIxXCJdO1xyXG4gICAgLy8gJChcIi5idG4tb3B0XCIpLmVhY2goZnVuY3Rpb24gKF8sIF9fKSB7XHJcbiAgICAvLyAgIGlmICgkKHRoaXMpLmF0dHIoXCJvcHQtaWRcIikgPT09IFwiYWxsXCIgfHwgJCh0aGlzKS5oYXNDbGFzcyhcImJ0bi1zZWNvbmRhcnlcIikpIHJldHVybjtcclxuICAgIC8vICAgb3B0U3RhcnMucHVzaCgkKHRoaXMpLmF0dHIoXCJvcHQtaWRcIikpO1xyXG4gICAgLy8gfSk7XHJcbiAgICAvL2NvbnNvbGUubG9nKG9wdFN0YXJzKTtcclxuICAgIC8vJChcIiN0Ym9keS1yZWNvbW1lbmRcIikuaHRtbChcIlwiKTtcclxuICAgIHZhciB0aGF0ID0gdGhpczsvL+aKinRoaXPlr7nosaHlpI3liLbliLDkuLTml7blj5jph490aGF0XHJcbiAgICBjb21icy5mb3JFYWNoKChjb21iOiB7IFtrZXk6IHN0cmluZ106IGFueSB9KSA9PiB7XHJcbiAgICAgIGxldCB0YWdzOiBzdHJpbmdbXSA9IGNvbWIudGFncztcclxuICAgICAgaWYgKHRhZ3MubGVuZ3RoID09PSAwIHx8IHRhZ3MubGVuZ3RoID4gMykgcmV0dXJuO1xyXG4gICAgICAvL0B0cy1pZ25vcmUgXHJcbiAgICAgIGxldCBjaGFyczogSGVyb0Jhc2ljW10gPSBbLi4udGhhdC5kYXRhLnRhZ3NfYXZhbFt0YWdzWzBdXV07Ly/liIflibLmr4/kuKrlrZfnrKZcclxuICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCB0YWdzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgbGV0IHJlZHVjZWRfY2hhcnM6IEhlcm9CYXNpY1tdPVtdO1xyXG5cclxuICAgICAgICBjaGFycy5mb3JFYWNoKChjaGFyOiBIZXJvQmFzaWMpID0+IHtcclxuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHRhZ3NfYXZhbFt0YWdzW2ldXSk7XHJcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhjaGFyKTtcclxuICAgICAgICAgIC8vQHRzLWlnbm9yZSBcclxuICAgICAgICAgIGxldCB0bXA6IEhlcm9CYXNpY1tdID0gdGhhdC5kYXRhLnRhZ3NfYXZhbFt0YWdzW2ldXTtcclxuICAgICAgICAgIHRtcC5mb3JFYWNoKCh0Z2NoOiBIZXJvQmFzaWMpID0+IHtcclxuICAgICAgICAgICAgaWYgKGNoYXIubmFtZSA9PT0gdGdjaC5uYW1lKSB7XHJcbiAgICAgICAgICAgICAgcmVkdWNlZF9jaGFycy5wdXNoKGNoYXIpO1xyXG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgLy9AdHMtaWdub3JlIFxyXG4gICAgICAgIGNoYXJzID0gcmVkdWNlZF9jaGFycztcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKGNoYXJzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG4gICAgICAvL0B0cy1pZ25vcmUgXHJcbiAgICAgIGlmICghdGFncy5pbmNsdWRlcyhcIumrmOe6p+i1hOa3seW5suWRmFwiKSkge1xyXG4gICAgICAgIC8vIGNvbnNvbGUubG9nKHRhZ3Muam9pbihcIixcIikgKyBcIiDkuI3lkKso6auY57qnKei1hOa3seW5suWRmFwiKTtcclxuICAgICAgICBsZXQgcmVkdWNlNjogYW55W10gPSBbXTtcclxuICAgICAgICBjaGFycy5mb3JFYWNoKGZ1bmN0aW9uIChjaGFyOiBhbnkpIHtcclxuICAgICAgICAgIGlmIChjaGFyLmxldmVsICE9PSA2KSB7XHJcbiAgICAgICAgICAgIHJlZHVjZTYucHVzaChjaGFyKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBjaGFycyA9IHJlZHVjZTY7XHJcbiAgICAgIH1cclxuICAgICAgbGV0IGZpbHRlcmVkX2NoYXJzOiBIZXJvQmFzaWNbXSA9IFtdO1xyXG4gICAgICBjaGFycy5mb3JFYWNoKGZ1bmN0aW9uIChjaGFyOiBIZXJvQmFzaWMpIHtcclxuICAgICAgICAvL2NvbnNvbGUubG9nKGNoYXIubGV2ZWwpO1xyXG4gICAgICAgIC8vQHRzLWlnbm9yZSBcclxuICAgICAgICBpZiAob3B0U3RhcnMuaW5jbHVkZXMoY2hhci5sZXZlbC50b1N0cmluZygpKSkge1xyXG4gICAgICAgICAgZmlsdGVyZWRfY2hhcnMucHVzaChjaGFyKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICAvL0B0cy1pZ25vcmUgXHJcbiAgICAgIGNoYXJzID0gZmlsdGVyZWRfY2hhcnM7XHJcblxyXG4gICAgICBjb21iLnBvc3NpYmxlID0gY2hhcnM7XHJcbiAgICAgIGlmIChjaGFycy5sZW5ndGggPT09IDApIHJldHVybjtcclxuICAgICAgbGV0IHMgPSAwO1xyXG4gICAgICBjaGFycy5mb3JFYWNoKGZ1bmN0aW9uIChjaGFyOiBhbnkpIHtcclxuICAgICAgICBzICs9IGNoYXIubGV2ZWw7XHJcbiAgICAgIH0pO1xyXG4gICAgICBzID0gcyAvIGNoYXJzLmxlbmd0aDtcclxuICAgICAgY29tYi5zY29yZSA9IHMgKyAwLjEgLyB0YWdzLmxlbmd0aCArIDAuOSAvIGNoYXJzLmxlbmd0aDtcclxuICAgIH0pO1xyXG4gICAgY29tYnMuc29ydChmdW5jdGlvbiAoYSwgYikge1xyXG4gICAgICByZXR1cm4gYS5zY29yZSA+IGIuc2NvcmUgPyAtMSA6IChhLnNjb3JlIDwgYi5zY29yZSA/IDEgOlxyXG4gICAgICAgIChhLnRhZ3MubGVuZ3RoID4gYi50YWdzLmxlbmd0aCA/IDEgOiAoYS50YWdzLmxlbmd0aCA8IGIudGFncy5sZW5ndGggPyAtMSA6XHJcbiAgICAgICAgICAwKSkpO1xyXG4gICAgfSk7XHJcbiAgICAvL2xldCBubyA9IDE7XHJcbiAgICBjb21icy5mb3JFYWNoKGZ1bmN0aW9uIChjb21iOiBhbnkpIHtcclxuICAgICAgaWYgKCFjb21iLnBvc3NpYmxlIHx8IGNvbWIucG9zc2libGUubGVuZ3RoID09PSAwKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgIGxldCBjaGFycyA9IGNvbWIucG9zc2libGU7XHJcbiAgICAgIHRoYXQuc2V0RGF0YSh7IHBvc3NpYmxlOiBjaGFyc30pO1xyXG4gICAgICBsZXQgdGFncyA9IGNvbWIudGFncztcclxuICAgICAgbGV0IHRhZ3NUTCA9IGNvbWIudGFnc1RMO1xyXG4gICAgICBsZXQgY2hhcnNfaHRtbCA6IGFueVtdO1xyXG4gICAgICAvLyBsZXQgY29sb3JzID0ge1xyXG4gICAgICAvLyAgIDE6IFwiZGFya1wiLFxyXG4gICAgICAvLyAgIDI6IFwibGlnaHRcIixcclxuICAgICAgLy8gICAzOiBcInN1Y2Nlc3NcIixcclxuICAgICAgLy8gICA0OiBcImluZm9cIixcclxuICAgICAgLy8gICA1OiBcIndhcm5pbmdcIixcclxuICAgICAgLy8gICA2OiBcImRhbmdlclwiXHJcbiAgICAgIC8vIH07XHJcbiAgICAgIGNvbWIucG9zc2libGUuc29ydChmdW5jdGlvbiAoYTogYW55LCBiOiBhbnkpIHtcclxuICAgICAgICByZXR1cm4gYS5sZXZlbCA+IGIubGV2ZWwgPyAtMSA6IChhLmxldmVsIDwgYi5sZXZlbCA/IDEgOiAwKTtcclxuICAgICAgfSk7XHJcbiAgICAgIC8vIGNoYXJzLmZvckVhY2goZnVuY3Rpb24gKF86IGFueSwgY2hhcjphbnkpIHtcclxuICAgICAgLy8gICBsZXQgcGFkZGluZyA9IHNob3dOYW1lICYmIGltYWdlU2l6ZSA8IDYwID8gXCJwYWRkaW5nLXJpZ2h0OiA0cHhcIiA6XHJcbiAgICAgIC8vICAgICBcInBhZGRpbmctcmlnaHQ6IDFweFwiO1xyXG4gICAgICAvLyAgIGxldCBzdHlsZSA9IHNob3dJbWFnZSA/IFwic3R5bGU9XFxcImJvcmRlci1yYWRpdXM6IDVweDtwYWRkaW5nOiAxcHggMXB4O1wiICtcclxuICAgICAgLy8gICAgIHBhZGRpbmcgKyBcIjtcXFwiIFwiIDogXCJcIjtcclxuICAgICAgLy8gICBsZXQgYnV0dG9uc3R5bGUgPSBpbWFnZVNpemUgPiAyNSA/XHJcbiAgICAgIC8vICAgICBcImJhY2tncm91bmQtY29sb3I6ICNBQUE7Ym9yZGVyLXJhZGl1czogNHB4O1wiIDpcclxuICAgICAgLy8gICAgIFwiYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7Ym9yZGVyLXJhZGl1czogNHB4O1wiO1xyXG4gICAgICAvLyAgIGNoYXJzX2h0bWwucHVzaChcIjxidXR0b24gdHlwZT1cXFwiYnV0dG9uXFxcIiBjbGFzcz1cXFwiYnRuIGJ0bi1zbSBidG4tXCIgK1xyXG4gICAgICAvLyAgICAgY29sb3JzW2NoYXIubGV2ZWxdICsgXCIgYnRuLWNoYXIgbXktMSBkLW5vbmUgZC1zbS1pbmxpbmVcXFwiIFwiICtcclxuICAgICAgLy8gICAgIHN0eWxlICsgXCJ0aXRsZT1cXFwiXCIgKyBjaGFyLm5hbWUgKyBcIlxcXCI+XCIpO1xyXG4gICAgICAvLyAgIGlmIChzaG93SW1hZ2UpIGNoYXJzX2h0bWwucHVzaChcIjxpbWcgc3R5bGU9XFxcIlwiICsgYnV0dG9uc3R5bGUgK1xyXG4gICAgICAvLyAgICAgXCJcXFwiaGVpZ2h0PVxcXCJcIiArIGltYWdlU2l6ZSArIFwiXFxcIiB3aWR0aD1cXFwiXCIgKyBpbWFnZVNpemUgK1xyXG4gICAgICAvLyAgICAgXCJcXFwiIHNyYz1cXFwiaW1nL2NoYXJhL1wiICsgY2hhci5pbWcgKyBcIi5wbmdcXFwiPiAgIFwiKTtcclxuICAgICAgLy8gICBpZiAoaW1hZ2VTaXplID4gNjApIGNoYXJzX2h0bWwucHVzaChcIjxkaXY+XCIpO1xyXG4gICAgICAvLyAgIGlmIChzaG93TmFtZSkgY2hhcnNfaHRtbC5wdXNoKGNoYXIubmFtZSk7XHJcbiAgICAgIC8vICAgaWYgKGltYWdlU2l6ZSA+IDYwKSBjaGFyc19odG1sLnB1c2goXCI8L2Rpdj5cIik7XHJcbiAgICAgIC8vICAgY2hhcnNfaHRtbC5wdXNoKFwiPC9idXR0b24+XFxuXCIpO1xyXG4gICAgICAvLyAgIGNoYXJzX2h0bWwucHVzaChcIjxidXR0b24gdHlwZT1cXFwiYnV0dG9uXFxcIiBjbGFzcz1cXFwiYnRuIGJ0bi1zbSBidG4tXCIgK1xyXG4gICAgICAvLyAgICAgY29sb3JzW2NoYXIubGV2ZWxdICsgXCIgYnRuLWNoYXIgbXktMSBkLWlubGluZSBkLXNtLW5vbmVcXFwiIFwiICtcclxuICAgICAgLy8gICAgIFwidGl0bGU9XFxcIlwiICsgY2hhci5uYW1lICsgXCJcXFwiPlwiICsgY2hhci5uYW1lICsgXCI8L2J1dHRvbj5cXG5cIik7XHJcbiAgICAgIC8vIH0pO1xyXG4gICAgICAvL2xldCB0YWdzX2h0bWwgPSBbXTtcclxuICAgICAgLy8gZm9yIChsZXQgaSA9IDA7IGkgPCB0YWdzLmxlbmd0aDsgaSsrKSB7XHJcblxyXG4gICAgICAvLyAgICAgdGFnc19odG1sLnB1c2goXHJcbiAgICAgIC8vICAgICAgICc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImJ0biBidG4tc20gYnRuLXNlY29uZGFyeSBidG4tY2hhciBteS0xXCI+JyArXHJcbiAgICAgIC8vICAgICAgIHRhZ3NbaV0gKyBcIjwvYnV0dG9uPlxcblwiKTtcclxuXHJcbiAgICAgIC8vIH1cclxuICAgICAgLy8gJChcIiN0Ym9keS1yZWNvbW1lbmRcIikuYXBwZW5kKFxyXG4gICAgICAvLyAgIFwiPHRyIGNsYXNzPVxcXCJ0ci1yZWNvbW1kXFxcIj5cIiArXHJcbiAgICAgIC8vICAgXCI8dGQgY2xhc3M9XFxcInB5LTIgZC1ub25lIGQtc20tdGFibGUtY2VsbFxcXCI+XCIgKyBubysrICsgXCI8L3RkPlwiICtcclxuICAgICAgLy8gICBcIjx0ZCBjbGFzcz1cXFwicHktMVxcXCI+XCIgKyB0YWdzX2h0bWwuam9pbihcIlwiKSArIFwiPC90ZD48dGQgY2xhc3M9XFxcInB5LTFcXFwiPlwiICtcclxuICAgICAgLy8gICBjaGFyc19odG1sLmpvaW4oXCJcIikgK1xyXG4gICAgICAvLyAgIFwiPC90ZD5cIiArXHJcbiAgICAgIC8vICAgXCI8dGQgY2xhc3M9XFxcInB5LTIgZC1ub25lIGQtc20tdGFibGUtY2VsbFxcXCI+XCIgKyBNYXRoLmZsb29yKGNvbWIuc2NvcmUgKlxyXG4gICAgICAvLyAgICAgMTAwKSAvIDEwMCArIFwiPC90ZD5cIiArXHJcbiAgICAgIC8vICAgXCI8L3RyPlwiKTtcclxuXHJcbiAgICB9KTtcclxuICAgIC8vIGlmIChsYW5nICE9PSAnY24nKSAkKCdbZGF0YS10b2dnbGU9XCJ0b29sdGlwXCJdJykudG9vbHRpcCgpO1xyXG4gICAgLy9odHRwczovL2FrLmdyYXVlbmVrby54eXovYWtoci5qc29uXHJcblxyXG5cclxuXHJcblxyXG4gIH0sXHJcbiAgaW5pdCgpIHtcclxuICAgIGxldCBfdGhhdCA9IHRoaXM7XHJcbiAgICBhcHAuZnVuYy5nZXQoJy9ha2hyLmpzb24nLCB7fSwgZnVuY3Rpb24gKGRhdGE6IEhlcm9bXSkge1xyXG5cclxuICAgICAgbGV0IHRhZ19jb3VudCA9IDA7XHJcbiAgICAgIGxldCBjaGFyX3RhZ19zdW0gPSAwO1xyXG4gICAgICAvLyBjb25zb2xlLmxvZyhkYXRhKTtcclxuXHJcblxyXG5cclxuXHJcbiAgICAgIGZvciAoY29uc3Qga2V5IGluIGRhdGEpIHtcclxuICAgICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XHJcbiAgICAgICAgICBjb25zdCBjaGFyID0gZGF0YVtrZXldO1xyXG4gICAgICAgICAgaWYgKGNoYXIuaGlkZGVuKSBjb250aW51ZTtcclxuICAgICAgICAgIGNoYXIudGFncyEucHVzaChjaGFyLnR5cGUgKyBcIuW5suWRmFwiKTtcclxuICAgICAgICAgIGNoYXIudGFncyEucHVzaChjaGFyLnNleCArIFwi5oCn5bmy5ZGYXCIpO1xyXG4gICAgICAgICAgbGV0IG5hbWUgPSBjaGFyLm5hbWU7XHJcbiAgICAgICAgICBjaGFyLnRhZ3MhLmZvckVhY2goZnVuY3Rpb24gKHRhZzogc3RyaW5nKSB7XHJcbiAgICAgICAgICAgIGlmICh0YWcgaW4gX3RoYXQuZGF0YS50YWdzX2F2YWwpIHtcclxuXHJcbiAgICAgICAgICAgICAgbGV0IHRtcDogeyBba2V5OiBzdHJpbmddOiBIZXJvQmFzaWNbXSB9ID0gX3RoYXQuZGF0YS50YWdzX2F2YWw7XHJcbiAgICAgICAgICAgICAgdG1wW3RhZ10ucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBcIm5hbWVcIjogbmFtZSxcclxuICAgICAgICAgICAgICAgIFwiaW1nXCI6IGNoYXJbXCJuYW1lLWVuXCJdLFxyXG4gICAgICAgICAgICAgICAgXCJsZXZlbFwiOiBjaGFyLmxldmVsLFxyXG4gICAgICAgICAgICAgICAgXCJ0eXBlXCI6IGNoYXIudHlwZVxyXG4gICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICBfdGhhdC5zZXREYXRhISh7IHRhZ3NfYXZhbDogdG1wIH0pXHJcblxyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICBsZXQgdG1wOiB7IFtrZXk6IHN0cmluZ106IEhlcm9CYXNpY1tdIH0gPSBfdGhhdC5kYXRhLnRhZ3NfYXZhbDtcclxuXHJcbiAgICAgICAgICAgICAgdG1wW3RhZ10gPSBbe1xyXG4gICAgICAgICAgICAgICAgXCJuYW1lXCI6IG5hbWUsXHJcbiAgICAgICAgICAgICAgICBcImltZ1wiOiBjaGFyW1wibmFtZS1lblwiXSxcclxuICAgICAgICAgICAgICAgIFwibGV2ZWxcIjogY2hhci5sZXZlbCxcclxuICAgICAgICAgICAgICAgIFwidHlwZVwiOiBjaGFyLnR5cGVcclxuICAgICAgICAgICAgICB9XTtcclxuXHJcbiAgICAgICAgICAgICAgX3RoYXQuc2V0RGF0YSEoeyB0YWdzX2F2YWw6IHRtcCB9KVxyXG4gICAgICAgICAgICAgIHRhZ19jb3VudCsrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNoYXJfdGFnX3N1bSsrO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBsZXQgdG1wOiB7IFtrZXk6IHN0cmluZ106IEhlcm8gfSA9IF90aGF0LmRhdGEuYWxsX2NoYXJzO1xyXG4gICAgICAgICAgdG1wLm5hbWUgPSB7XHJcbiAgICAgICAgICAgICdsZXZlbCc6IGNoYXIubGV2ZWwsXHJcbiAgICAgICAgICAgICd0YWdzJzogY2hhci50YWdzXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgICAgX3RoYXQuc2V0RGF0YSEoeyBhbGxfY2hhcnM6IHRtcCB9KVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuXHJcblxyXG5cclxuICAgICAgX3RoYXQuc2V0RGF0YSEoeyBhdmdfY2hhcl90YWc6IChjaGFyX3RhZ19zdW0gLyB0YWdfY291bnQpIH0pO1xyXG5cclxuICAgICAgX3RoYXQuc2V0RGF0YSEoeyBjaGVja2VkVGFnczogW1wi5rK755aXXCJdIH0pXHJcbiAgICAgIF90aGF0LmNhbGMoKTtcclxuICAgIH0pO1xyXG4gIH0sXHJcbiAgY2xpY2tUYWcoZXZlbnQpIHtcclxuICAgIGNvbnNvbGUubG9nKGV2ZW50KTtcclxuICAgIGxldCBfdGhhdCA9IHRoaXM7XHJcbiAgICBsZXQgdGFnID0gZXZlbnQudGFyZ2V0LmRhdGFzZXQudGl0bGU7XHJcbiAgICBsZXQgY2hlY2tlZCA9IGZhbHNlO1xyXG5cclxuICAgIC8v5piv5ZCm54K56L+HXHJcbiAgICBpZiAodGFnIGluIF90aGF0LmRhdGEuY2hlY2tlZFRhZ3Mpe1xyXG4gICAgICBjaGVja2VkID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoY2hlY2tlZCkge1xyXG4gICAgICBfdGhhdC5kYXRhLmNoZWNrZWRUYWdzID0gX3RoYXQuZGF0YS5jaGVja2VkVGFncy5maWx0ZXIoZnVuY3Rpb24gKHYsIF8sIF9fKSB7XHJcbiAgICAgICAgcmV0dXJuIHYgIT09IHRhZztcclxuICAgICAgfSk7XHJcblxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgaWYgKF90aGF0LmRhdGEuY2hlY2tlZFRhZ3MubGVuZ3RoID49IDYpIHtcclxuXHJcbiAgICAgICAgd3guc2hvd1RvYXN0KHtcclxuICAgICAgICAgIHRpdGxlOiBcIuaXoOazlemAieaLqeabtOWkmuagh+etvu+8muacgOWkmjbkuKrjgIJcIlxyXG4gICAgICAgICAgaWNvbjogXCJub25lXCIsXHJcbiAgICAgICAgICBkdXJhdGlvbjogMjAwMFxyXG4gICAgICAgIH0pXHJcblxyXG4gICAgICAgIC8vYWxlcnQoXCLml6Dms5XpgInmi6nmm7TlpJrmoIfnrb7vvJrmnIDlpJo25Liq44CCXCIpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICBfdGhhdC5kYXRhLmNoZWNrZWRUYWdzLnB1c2godGFnKTtcclxuICAgICAgICBfdGhhdC5zZXREYXRhKHtcclxuICAgICAgICAgIGNoZWNrZWRUYWdzOiBfdGhhdC5kYXRhLmNoZWNrZWRUYWdzXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIC8vJCh0aGlzKS50b2dnbGVDbGFzcyhcImJ0bi1wcmltYXJ5IGJ0bi1zZWNvbmRhcnlcIik7XHJcbiAgICBfdGhhdC5jYWxjKCk7XHJcblxyXG5cclxuXHJcbiAgfVxyXG5cclxuXHJcbn0pIl19